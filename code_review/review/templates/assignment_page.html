<!-- Template for showing a specific assignment's information -->
{% extends 'navbar.html' %}

<!-- This page can only be called if an assignment exists, obviously -->
<!-- grabs the name of the current assignment -->
  
{% block main %}
<br />
  <h1>{{ asmt.name }}</h1>
<br />

<div class="row">  
    {% if user.is_superuser %}
        <!-- Add stuff to allow superuser to edit assignment -->
        <div class="col-md-3">
                <div class="btn-group">
                        <a class="btn btn-default" href="#"><span class=" glyphicon glyphicon-wrench"></span> Settings</a>
                </div>
        </div>
        <div class="col-md-9"></div>  
    {% endif %}

  {% if user.is_superuser or user.isStaff %}
    <h2>Assign students to review peer submissions:</h2>
    <a href="assign_reviews">
        <button>"Assign Reviews"</button>
    </a>
  {% endif %}
</div>

<br />

<div class="row">
<div class="col-md-12">
<div class="panel panel-default">
  <div class="panel-heading">
  	<!-- if the assignment is still open for submission this will be viewable -->
  	{% if canSubmit %}
		<h3 class="panel-title">Submissions are <span class="label label-success">Open</span></h3>
	{% else %}
  		<h3 class="panel-title">Submissions are <span class="label label-danger">Closed</span></h3>
  	{% endif %}
  </div>
  
  <div class="panel-body">
  	<p><b>Assignment due on: </b><br /> {{ asmt.submission_close_date }}</p> 
  	<p><b>Review opens on: </b><br /> {{ asmt.review_open_date }}</p> 
  	<p><b>Review closes on: </b><br /> {{ asmt.review_close_date }}</p>   
  </div>
  
  {% if canSubmit %}
  <div class="panel-footer">
  	<form action="submit/">
    	<input class="btn btn-default btn-danger" type="submit" value="Submit Assignment">
  	</form>
  </div>
  {% endif %}
</div>
</div>
</div>

{% if submissions %}
  <div class="panel panel-default">
  	<div class="panel-heading">
  		<h3 class="panel-title">Past Submissions</h3>
  	</div>
    <table class="table table-bordered">
    	<thead>
    		<tr>
        		<th>Submission Time</th>
        		<th>Submission Repository</th>
        		<th>View Submission</th>	
    		</tr>
    	</thead>
    	
    	<tbody>
    		{% for sub in submissions %}
    		<tr>
        		<td>{{ sub.submission_date }} </td>
        		<td>{{ sub.submission_repository }}</td>
        		<td>
            		<form action="{% url 'submission' sub.submission_uuid %}">
                		<input class="btn btn-default btn-primary" type="submit" value="View Submission">
            		</form>
        		</td>
        	</tr>
        	{% endfor %}
    	</tbody>
    </table>
  </div>
  {% endif %}

<!-- Submission to review -->
<div>
{% if canReview and submissionsToReview %}
    <h3> Reviews per student: {{asmt.reviews_per_student}} reviews. </h3>
    <h3> You have been assigned to do {{actualNumReviews }} reviews. </h3>
    <h3> You have {{numRemaining}} reviews left to complete. </h3>
    <h3> Submissions you have been assigned to review: </h3>
    
    <table>
    <tr>
        <th>Submission number</th>
        <th></th>
        <th>Number of annotations completed</th>
    </tr>
    {% for submission, numAnnotations in submissionsToReview.items %}
    <tr>
        <td>{{submission.submission_uuid}}</td>
        <td><a href="{% url 'submission' submission.submission_uuid %}">
            <button>Review this submission</button>
        </a>
        </td>
        <td>Completed {{numAnnotations}} annotations of {{asmt.min_annotations}}</td>
    </tr>
    
    {% endfor %}
    </table>
{% endif %}
</div>
{% endblock %}
